<!DOCTYPE html> <html lang="zh-Hant"> <head>
    <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Final</title> <style>
        :root {
            --primary: #4285f4; /* 定義定位按鈕的藍色 */
            --light-grey: #e0e0e0; /* 定義功能按鈕的淺灰色 */
        }
        body {
            font-family: -apple-system, sans-serif; /* 設定系統預設字體 */
            margin: 0; /* 清除網頁外邊距 */
            padding: 15px; /* 設定網頁內邊距 */
            background-color: #f4f7f6; /* 背景設為淺灰綠色 */
            display: flex; /* 啟用彈性佈局 */
            justify-content: center; /* 讓內容水平置中 */
        }
        .container {
            width: 100%; /* 手機版寬度佔滿 */
            max-width: 600px; /* 電腦版限制最大寬度 */
            background: white; /* 內容區背景白色 */
            padding: 25px; /* 內容區內距 */
            border-radius: 20px; /* 容器圓角 */
            box-shadow: 0 10px 25px rgba(0,0,0,0.08); /* 設定陰影效果 */
            text-align: center; /* 文字置中 */
        }
        h2 { color: #333; margin-bottom: 10px; } /* 標題樣式 */
        #status {
            margin: 15px 0; /* 狀態欄上下間距 */
            padding: 10px; /* 狀態欄內距 */
            font-size: 14px; /* 字體大小 */
            color: #666; /* 文字顏色 */
            background: #f9f9f9; /* 狀態欄底色 */
            border-radius: 8px; /* 狀態欄圓角 */
        }
        .btn-main {
            width: 100%; /* 主按鈕寬度佔滿 */
            padding: 15px; /* 主按鈕高度 */
            background-color: var(--primary); /* 使用藍色 */
            color: white; /* 文字白色 */
            border: none; /* 移除邊框 */
            border-radius: 12px; /* 圓角設定 */
            font-size: 16px; /* 字體大小 */
            font-weight: bold; /* 加粗文字 */
            cursor: pointer; /* 手指游標 */
            margin-bottom: 20px; /* 下方間距 */
        }
        .grid-menu {
            display: grid; /* 啟用網格佈局 */
            grid-template-columns: 1fr 1fr; /* 設定為兩欄排列 */
            gap: 12px; /* 按鈕之間的間距 */
        }
        .grid-menu button {
            padding: 12px; /* 按鈕高度 */
            border: none; /* 移除邊框 */
            border-radius: 10px; /* 按鈕圓角 */
            background-color: var(--light-grey); /* 統一淺灰色 */
            color: #333; /* 文字顏色 */
            font-weight: 600; /* 半粗體字 */
            cursor: pointer; /* 手指游標 */
            transition: all 0.2s; /* 點擊動畫轉場 */
        }
        .grid-menu button:disabled {
            background-color: #f0f0f0; /* 禁用時底色變淡 */
            color: #ccc; /* 禁用時文字變灰 */
            cursor: not-allowed; /* 禁用時游標顯示禁止 */
        }
        .btn-full {
            grid-column: span 2; /* 讓特定的按鈕橫跨兩欄顯示 */
        }
        #map-container {
            margin-top: 25px; /* 地圖與上方間距 */
            height: 400px; /* 地圖顯示高度 */
            display: none; /* 初始狀態隱藏地圖 */
            border-radius: 15px; /* 地圖區圓角 */
            overflow: hidden; /* 隱藏溢出邊框的內容 */
            border: 2px solid #eee; /* 地圖外框線 */
        }
        iframe { width: 100%; height: 100%; border: 0; } /* 地圖框架填滿設定 */
    </style>
</head>
<body>

    <div class="container"> <h2>Final</h2> <p style="color: #888;">探索您的所在位置與週邊設施</p> <button class="btn-main" onclick="getLocation()">點擊獲取當前定位</button> <div id="status">尚未取得位置數據</div> <div class="grid-menu"> <button id="btn-store" onclick="searchNearby('便利商店')" disabled>找便利商店</button> <button id="btn-restaurant" onclick="searchNearby('餐廳')" disabled>找附近餐廳</button> <button id="btn-school" onclick="searchNearby('學校')" disabled>找附近學校</button> <button id="btn-mall" onclick="searchNearby('百貨公司')" disabled>找百貨公司</button> <button id="btn-market" class="btn-full" onclick="searchNearby('超市')" disabled>找附近超市</button> 
            <button id="btn-reset" class="btn-full" style="background-color: #999; color: white;" onclick="searchNearby('')" disabled>重置（回到目前位置）</button>
        </div>

        <div id="map-container"> <iframe id="google-map" src=""></iframe> </div>
    </div>

    <script>
        let lat = 0; // 存儲緯度
        let lon = 0; // 存儲經度
        const statusText = document.getElementById('status'); // 抓取狀態元素
        const mapBox = document.getElementById('map-container'); // 抓取地圖容器
        const mapIframe = document.getElementById('google-map'); // 抓取地圖框架
        // 包含所有按鈕 ID 的清單，方便一次啟用
        const allButtons = ['btn-store', 'btn-restaurant', 'btn-school', 'btn-mall', 'btn-market', 'btn-reset'];

        function getLocation() { // 請求定位的函數
            if (navigator.geolocation) { // 檢查瀏覽器是否支援定位
                statusText.textContent = "正在獲取 GPS 訊號..."; // 提示正在定位
                navigator.geolocation.getCurrentPosition(showPosition, showError); // 向系統申請位置
            } else {
                statusText.textContent = "您的瀏覽器不支持定位功能。"; // 不支援時報錯
            }
        }

        function showPosition(position) { // 定位成功後的處理
            lat = position.coords.latitude; // 取得緯度
            lon = position.coords.longitude; // 取得經度
            statusText.innerHTML = `定位成功！<br>緯度: ${lat.toFixed(4)} / 經度: ${lon.toFixed(4)}`; // 顯示經緯度

            allButtons.forEach(id => document.getElementById(id).disabled = false); // 解鎖所有搜尋按鈕
            
            mapBox.style.display = "block"; // 顯示地圖容器
            // 預設載入目前位置
            mapIframe.src = `https://maps.google.com/maps?q=${lat},${lon}&z=16&output=embed`; 
        }

        function searchNearby(keyword) { // 週邊搜尋函數
            mapBox.style.display = "block"; // 顯示地圖
            let url = ""; // 初始化網址變數
            
            if (keyword === "") { // 如果關鍵字為空（代表點擊重置）
                url = `https://maps.google.com/maps?q=${lat},${lon}&z=16&output=embed`; // 載入單純的定位點
            } else { // 如果有搜尋關鍵字
                // 結合關鍵字與經緯度進行區域搜尋
                url = `https://maps.google.com/maps?q=${encodeURIComponent(keyword)}&ll=${lat},${lon}&z=15&output=embed`; 
            }
            
            mapIframe.src = url; // 設定地圖框架網址，更新畫面內容

            if (window.innerWidth < 600) { // 手機版自動捲動優化
                setTimeout(() => {
                    mapBox.scrollIntoView({ behavior: 'smooth' }); // 平滑捲動至地圖
                }, 300); // 延遲執行確保載入流暢
            }
        }

        function showError(error) { // 定位失敗處理
            statusText.textContent = "定位失敗：" + error.message; // 顯示錯誤訊息
        }
    </script>
</body>
</html>
